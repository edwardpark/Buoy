

<%= render 'fb_comments' %>

<header id="main">
  <h1><%= @event.name %></h1>
  <%= link_to events_path, :class => "block" do %>
    <div class="pull-left">
      <i class="fa fa-chevron-left"></i>
    </div>
  <% end %>
  <%= link_to edit_event_path(@event), :class => "block" do %>
    <div class="pull-right">
      <i class="fa fa-pencil"></i>
    </div>
  <% end %>
  
  
</header>

<div id="view">
  <div class="container">
    <div class="event-block">
      <% if @event.venues.count > 0 %>
      <div class="event-map">
        <div id="map-container">
          <div id="map"></div>
        </div>
      </div>
      <% else %>
      <div class="event-no-map">
        <%= link_to "Add a Venue", edit_event_path(@event), :class => "tall-block" %>
      </div>
      <% end %>
      <div class="event-info">
        <div class="content">
          <%= render 'event_info' %>  
        </div> <!-- /.content -->
      </div> <!-- /.event-info -->
    </div> <!-- /.event-block -->
  </div> <!-- /.container -->
</div> <!-- /#view -->

<script src="//maps.google.com/maps/api/js?v=3.13&sensor=false&libraries=geometry,places" type="text/javascript"></script>
<script src="//google-maps-utility-library-v3.googlecode.com/svn/tags/markerclustererplus/2.0.14/src/markerclusterer_packed.js" type="text/javascript"></script>

<script type="text/javascript">
    <% 
      if @hash.first.nil?
        @hash = [{:lat => 40.782001,:lng => -73.832703}]
      end
    %> 
    handler = Gmaps.build('Google');
    handler.buildMap({ 
      provider: {
      auto_zoom:true//, 
      //maxZoom:14
    }, 
    internal: { id: 'map'}}, 
    function(){
      markers = handler.addMarkers(<%=raw @hash.to_json %>);
      handler.bounds.extendWith(markers);
      handler.fitMapToBounds();
    });
    handler.callback = function() {
      if (handler.markers.length == 1) {

        var marker = Gmaps.map.markers[0];
        var infowindow = marker.infowindow;
        infowindow.open(Gmaps.map.map, marker);
        <%#*alert("Gmaps info open");%>
      }
    }

</script>